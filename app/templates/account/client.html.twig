{# templates/account/client.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Mon Compte{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
    <link rel="stylesheet" href="{{ asset('css/account.css') }}">
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/account.js') }}" defer></script>
{% endblock %}

{% block body %}
    <header>
    </header>
    
    <div class="account-container">
        <aside class="account-sidebar">
            <img src="{{ asset(app.user.avatar ?? 'assets/img/avatar2.png') }}" alt="Avatar" class="user-avatar">
            <h2>{{ app.user.firstname }} {{ app.user.lastname }}</h2>
            <p>Membre depuis {{ app.user.createdAt|date('d/m/Y') }}</p>
            
            <nav class="account-menu">
                <ul>
                    <li><a href="{{ path('app_client') }}" class="{{ app.current_route == 'app_client' ? 'active' }}">Tableau de bord</a></li>
                    
                    {# Section Réservations - Version sécurisée #}
                    {% if is_granted('ROLE_USER') %}
                        {# <li><a href="{{ path('app_book') }}" class="{{ app.current_route starts with 'app_book' ? 'active' }}">Mes réservations</a></li> #}
                    {% endif %}
                    
                    {# Section Profil - Version optimisée #}
                    <li><a href="{{ path('app_account') }}" class="{{ app.current_route starts with 'app_account' ? 'active' }}">Mon profil</a></li>
                    
                    {# Section Mot de passe #}
                    <li><a href="{{ path('app_reset_password_request') }}" class="{{ app.current_route starts with 'app_reset_password_request' ? 'active' }}">Changer mon mot de passe</a></li>
                    
                    <li><a href="{{ path('app_logout') }}">Déconnexion</a></li>
                </ul>
            </nav>
        </aside>
        
        <main class="account-content">
            <h2 class="section-title">Tableau de bord</h2>
            
            <section class="user-info">
                <h2>Informations personnelles</h2>
                <p><strong>Nom :</strong> {{ app.user.lastname }}</p>
                <p><strong>Prénom :</strong> {{ app.user.firstname }}</p>
                <p><strong>Email :</strong> {{ app.user.email }}</p>
                <p><strong>Téléphone :</strong> {{ app.user.phone ?? 'Non renseigné' }}</p>
                <a href="{{ path('app_account') }}" class="btn btn-primary">Modifier mon profil</a>
            </section>
            
            {# Section Réservations - Version améliorée #}
            <section class="reservations">
                <h2 class="section-title">Mes dernières réservations</h2>
                
                {% if bookings is defined and bookings|length > 0 %}
                    {% for booking in bookings|slice(0, 2) %}
                        <div class="reservation-card">
                            <div>
                                <h3>{{ booking.room.name }}</h3>
                                <p>Du {{ booking.startDate|date('d/m/Y') }} au {{ booking.endDate|date('d/m/Y') }}</p>
                                <p>Prix total : {{ booking.totalPrice|format_currency('EUR') }}</p>
                                <p>Statut : {{ booking.status|capitalize }}</p>
                            </div>
                            <div>
                                <a href="{{ path('app_book', {id: booking.id}) }}" class="btn btn-primary">Détails</a>
                            </div>
                        </div>
                    {% endfor %}
                    
                    {% if bookings|length > 2 %}
                        <a href="{{ path('app_bookings') }}" class="btn btn-primary">Voir toutes mes réservations ({{ bookings|length }})</a>
                    {% endif %}
                {% else %}
                    <p class="no-reservations">Aucune réservation récente</p>
                    {# <a href="{{ path('app_book') }}" class="btn btn-primary">Réserver maintenant</a> #}
                {% endif %}
            </section>
        </main>
    </div>
{% endblock %}